function Filter(){this.message_window=$(".filter_tooltip"),this.catalog_id=$("[name=catalog]").val(),this.checkbox_changed=null,this.product_box=_.template($("#product_template").html()),this.timerId=null,this.getCatalogId=function(){return this.catalog_id},this.getProductBox=function(){return this.product_box},this.select_live_event=function(){$(".select_line").click(function(){$(this).hasClass("open")?$(this).removeClass("open"):($(".select_line").removeClass("open"),$(this).addClass("open"))})},this.reset_event=function(){var e=this;$(".reset").click(function(t){t.preventDefault(),$("input").removeAttr("checked"),$(".select_line").html(""),e.clearDisabled()})},this.setChangedCheckbox=function(e){this.checkbox_changed=e},this.getChangedCheckbox=function(){return $(this.checkbox_changed)},this.getFilterCollection=function(){return $(".select_checkbox input[type=checkbox],.filter_brands input[type=checkbox]")},this.getCheckedFilterCollection=function(){return $(".select_checkbox input[type=checkbox]:checked,.filter_brands input[type=checkbox]:checked,")},this.clearFilter=function(){$("input").removeAttr("checked")},this.getSort=function(){return $('[name="sort"]:checked').val()},this.getDisabledBy=function(){return this.getChangedCheckbox().parent().hasClass("select_checkbox")?"haracteristic":"brand"},this.getCountAjaxData=function(e){var t={filter:this.getFilterJson(),disabled_by:this.getDisabledBy(),catalog:this.getCatalogId(),cost_trade:this.getPrice(),cur:e.val()};return t},this.sendAjaxCountData=function(e){var t=this;$.get("/product_catalog/filter",t.getCountAjaxData(e),function(e){t.setDataForWindow(e.count);var i="haracteristic"==t.getDisabledBy()&&t.getCheckedHaracteristicCollection().size()>0||0==t.getCheckedBrandCollection().size()&&t.getCheckedHaracteristicCollection().size()>0&&"brand"==t.getDisabledBy(),s=t.getCheckedBrandCollection().size()>0&&"brand"==t.getDisabledBy()||t.getCheckedBrandCollection().size()>0&&0==t.getCheckedHaracteristicCollection().size()&&"haracteristic"==t.getDisabledBy();(i||s)&&(console.log("data"),console.log(e),console.log("disable_filters"),console.log(e.disable_filters),t.disable_filters(e.disable_filters))})},this.clearDisabledAll=function(){var e=this.getFilterCollection();$(".select_checkbox").removeClass("disabled"),e.removeAttr("disabled"),e.removeClass("disabled")},this.clearDisabled=function(){var e;"brand"===this.getDisabledBy()?(e=this.getHaracteristicCollection(),$(".select_checkbox").removeClass("disabled"),e.removeAttr("disabled"),e.removeClass("disabled")):this.clearDisabledAll()},this.getHaracteristicCollection=function(){return $(".select_checkbox input[type=checkbox]")},this.getCheckedHaracteristicCollection=function(){return $(".select_checkbox input[type=checkbox]:checked")},this.getBrandCollection=function(){return $(".filter_brands input[type=checkbox]")},this.getCheckedBrandCollection=function(){return $(".filter_brands input[type=checkbox]:checked")},this.changeFilter=function(){var e=this,t=this.getFilterCollection();t.change(function(){e.setChangedCheckbox(this),e.clearDisabled(),e.setLine(),e.showWindowWithMessage(),e.sendAjaxCountData($(this))})},this.setLine=function(){this.getChangedCheckbox().parent().hasClass("select_checkbox")&&(this.getChangedCheckbox().is(":checked")?this.appendFilterFromLine():this.deleteFilterFromLine())},this.appendFilterFromLine=function(){var e=this.getChangedCheckbox().parent().find("label").html();this.getChangedCheckbox().parents(".select").find(".select_line").append("<div>"+e+"</div>")},this.deleteFilterFromLine=function(){if(this.deleteFilterFromLine.arguments.length>0){var e=this.deleteFilterFromLine.arguments[0],t=$(e).find("label").html();$(e).parents(".select").find(".select_line").find("div:contains('"+t+"')").remove()}else{var t=this.getChangedCheckbox().parent().find("label").html();this.getChangedCheckbox().parents(".select").find(".select_line").find("div:contains('"+t+"')").remove()}},this.getFilterJson=function(){return $.toJSON(this.getCheckedFilterCollection().serializeArray())},this.showWindowWithMessage=function(){clearTimeout(this.timerId),$(".filter_tooltip").removeClass("show");var e=$(this.checkbox_changed).parent(),t=e.offset().top+e.height();this.message_window.css("top",t),this.message_window.css("left",e.offset().left),this.message_window.addClass("show width_message")},this.setDataForWindow=function(e){console.log("count"),console.log(e),console.log(this.message_window.find(".product_info span:first a").html()),this.message_window.find(".product_info span:first a").html(e),$(".filter_tooltip").removeClass("width_message"),this.timerId=setTimeout(function(){$(".filter_tooltip").removeClass("show")},2e3)},this.getProductHaracteristicChecked=function(){return $(".product_haracteristic_filter input:checked")},this.getProductHaracteristicCheckedSize=function(){return $(".product_haracteristic_filter input:checked").size()},this.getBrandChecked=function(){return $(".product_haracteristic_filter input:checked")},this.getBrandCheckedSize=function(){return $(".filter_brands input:checked").size()},this.needDisabled=function(){return"haracteristic"===this.getDisabledBy()&&this.getProductHaracteristicCheckedSize()>0||"brand"===this.getDisabledBy()&&this.getBrandCheckedSize()>0},this.disable_filters=function(e){console.log(e);var t=this;t.clearDisabled(),t.needDisabled()===!0&&$.each(e,function(e,i){$.each(i,function(i,s){t.set_disable_checkbox(e+s)})})},this.set_disable_checkbox=function(e){$("."+e).addClass("disabled"),$("."+e+" input").removeAttr("checked"),$("."+e+" input").attr("disabled","disabled"),this.deleteFilterFromLine("."+e)},this.filter_button_click=function(){var e=this;$(".filter .button").click(function(){e.show_products()})},this.show_products=function(){console.clear();var e=this;$(".product_list").html(""),$.get("/product_catalog/getFilterProduct",e.getProductUpdateAjaxData(),function(t){$.each(t,function(t,i){e.appendProduct(i)})})},this.show_click=function(){var e=this;$("body").on("click",".show_link",function(t){t.preventDefault(),e.show_products()})},this.appendProduct=function(e){var t=this.product_box({img:e.img,cost_trade:e.cost_trade,name:e.name,id:e.id,alias:e.alias,sales_leader:e.sales_leader});t=$(t),1==e.viewcost?t.find(".price_info.nocost").remove():(t.find(".price_info:not(.nocost)").remove(),t.find(".buy").remove()),1==e.sales_leader&&(t.prepend('<div class="sticker">&nbsp;</div>'),t.addClass("with_sticker")),$(".product_list").append(t)},this.getProductUpdateAjaxData=function(){var e={filter:this.getFilterJson(),catalog:this.getCatalogId(),sort:this.getSort(),cost_trade:this.getPrice()};return e},this.getPrice=function(){return{min:$("#minCost").val(),max:$("#maxCost").val()}},this.window_close_event=function(){$(".filter_tooltip .close").click(function(){clearTimeout(this.timerId),$(".filter_tooltip").removeClass("show")})},this.init=function(){this.clearDisabledAll(),this.select_live_event(),this.changeFilter(),this.reset_event(),this.filter_button_click(),this.window_close_event(),this.show_click()},this.test_cache=function(){var e=this;$(".filter").before("<div class='tc' style='background:red;width:30px;height:30px'></div>"),$(".filter").before("<div class='link_info' ></div>"),$(".tc").click(function(){console.clear();var t=e.getCountAjaxData();$.ajax({url:"/catalog/frame",type:"POST",data:t,beforeSend:function(e,t){$(".link_info").html("<a class='hhh'>1</a>"),$(".hhh").attr("href","/product_catalog/filter/?"+t.data)},success:function(){}})})}}$(document).ready(function(){var e=new Filter;e.init()}),$(document).ready(function(){var e=$("#slider").data("min"),t=$("#slider").data("max");$("#slider").slider({min:e,max:t,values:[e,t],range:!0,stop:function(){$("input#minCost").val($("#slider").slider("values",0)),$("input#maxCost").val($("#slider").slider("values",1))},slide:function(){$("input#minCost").val($("#slider").slider("values",0)),$("input#maxCost").val($("#slider").slider("values",1))}}),$("#maxCost").val(t),$("input#minCost").change(function(){var e=$("input#minCost").val(),t=$("input#maxCost").val();parseInt(e)>parseInt(t)&&(e=t,$("input#minCost").val(e)),$("#slider").slider("values",0,e)}),$("input#maxCost").change(function(){var e=$("input#minCost").val(),i=$("input#maxCost").val();i>t&&(i=t,$("input#maxCost").val(t)),parseInt(e)>parseInt(i)&&(i=e,$("input#maxCost").val(i)),$("#slider").slider("values",1,i)}),$("input").keypress(function(e){var t,i;if(!e)var e=window.event;return e.keyCode?t=e.keyCode:e.which&&(t=e.which),null==t||0==t||8==t||13==t||9==t||46==t||37==t||39==t?!0:(i=String.fromCharCode(t),/\d/.test(i)?void 0:!1)})});